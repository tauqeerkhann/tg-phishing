# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "DENY"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"

# Prevent directory listing
Options -Indexes

# Custom error pages
ErrorDocument 404 /index.php?page=404
ErrorDocument 403 /index.php?page=403

# URL rewriting
RewriteEngine On

# Force HTTPS in production (Render.com provides HTTPS)
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Route all requests through index.php for better control
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?path=$1 [QSA,L]

# Protect sensitive files
<FilesMatch "\.(json|log|ini|htaccess)$">
    Require all denied
</FilesMatch>

# Allow access to specific JSON files for the application
<Files "users.json">
    Require all granted
</Files>

# Set PHP values
php_value upload_max_filesize 10M
php_value post_max_size 10M
php_value max_execution_time 300
php_value session.gc_maxlifetime 1440